<section class="admin-section">
    <div class="container">
        <div class="section-header">
            <h1>üë§ Chi Ti·∫øt Ng∆∞·ªùi D√πng</h1>
            <a href="/admin/users" class="btn btn-secondary">‚Üê Quay L·∫°i</a>
        </div>

        <!-- Enhanced user detail with comprehensive information -->
        <div class="detail-card">
            <h3>üìã Th√¥ng Tin C√° Nh√¢n</h3>
            <div class="info-grid">
                <div class="info-item">
                    <strong>Email:</strong>
                    <span><%= user.email %></span>
                </div>
                <div class="info-item">
                    <strong>T√™n:</strong>
                    <span><%= user.name || 'N/A' %></span>
                </div>
                <div class="info-item">
                    <strong>S·ªë ƒêi·ªán Tho·∫°i:</strong>
                    <span><%= user.phone || 'N/A' %></span>
                </div>
                <div class="info-item">
                    <strong>ƒê·ªãa Ch·ªâ:</strong>
                    <span><%= user.address || 'N/A' %></span>
                </div>
                <div class="info-item">
                    <strong>Ng√†y ƒêƒÉng K√Ω:</strong>
                    <span><%= new Date(user.createdAt).toLocaleDateString('vi-VN') %></span>
                </div>
                <div class="info-item">
                    <strong>Tr·∫°ng Th√°i:</strong>
                    <span class="status-badge status-confirmed">Ho·∫°t ƒê·ªông</span>
                </div>
            </div>
        </div>

        <!-- Added comprehensive payment history -->
        <% if (payments && payments.length > 0) { %>
        <div class="detail-card">
            <h3>üí∞ L·ªãch S·ª≠ Thanh To√°n (<%= payments.length %>)</h3>
            <table class="admin-table">
                <thead>
                    <tr>
                        <th>M√£ Thanh To√°n</th>
                        <th>Lo·∫°i</th>
                        <th>S·ªë Ti·ªÅn</th>
                        <th>Ph∆∞∆°ng Th·ª©c</th>
                        <th>Tr·∫°ng Th√°i</th>
                        <th>Ng√†y Thanh To√°n</th>
                    </tr>
                </thead>
                <tbody>
                    <% payments.forEach(payment => { %>
                    <tr>
                        <td><%= payment._id.toString().slice(-8) %></td>
                        <td>
                            <% if (payment.orderId) { %>
                                <span class="type-badge order">ƒê∆°n H√†ng</span>
                            <% } else if (payment.reservationId) { %>
                                <span class="type-badge reservation">ƒê·∫∑t B√†n</span>
                            <% } %>
                        </td>
                        <td><strong><%= payment.finalAmount?.toLocaleString('vi-VN') %> ƒë</strong></td>
                        <td>
                            <% if (payment.paymentMethod === 'bank') { %>
                                üè¶ Chuy·ªÉn Kho·∫£n
                            <% } else if (payment.paymentMethod === 'momo') { %>
                                üì± MoMo
                            <% } else { %>
                                üíµ Ti·ªÅn M·∫∑t
                            <% } %>
                        </td>
                        <td><span class="status-badge status-<%= payment.status %>"><%= payment.status %></span></td>
                        <td><%= payment.paidAt ? new Date(payment.paidAt).toLocaleDateString('vi-VN') : 'N/A' %></td>
                    </tr>
                    <% }) %>
                </tbody>
            </table>
        </div>
        <% } %>

        <% if (orders && orders.length > 0) { %>
        <div class="detail-card">
            <h3>üõí ƒê∆°n H√†ng (<%= orders.length %>)</h3>
            <table class="admin-table">
                <thead>
                    <tr>
                        <th>M√£ ƒê∆°n</th>
                        <th>Lo·∫°i</th>
                        <th>Chi Nh√°nh</th>
                        <th>T·ªïng Ti·ªÅn</th>
                        <th>Tr·∫°ng Th√°i</th>
                        <th>Ng√†y T·∫°o</th>
                    </tr>
                </thead>
                <tbody>
                    <% orders.forEach(order => { %>
                    <tr>
                        <td><%= order._id.toString().slice(-6) %></td>
                        <td>
                            <% if (order.orderType === 'dine-in') { %>
                                üçΩÔ∏è ƒÇn T·∫°i Qu√°n
                            <% } else { %>
                                üì¶ Mang V·ªÅ
                            <% } %>
                        </td>
                        <td><%= order.branchId?.name || 'N/A' %></td>
                        <td><strong><%= order.finalPrice?.toLocaleString('vi-VN') %> ƒë</strong></td>
                        <td><span class="status-badge status-<%= order.status %>"><%= order.status %></span></td>
                        <td><%= new Date(order.createdAt).toLocaleDateString('vi-VN') %></td>
                    </tr>
                    <% }) %>
                </tbody>
            </table>
        </div>
        <% } %>

        <% if (reservations && reservations.length > 0) { %>
        <div class="detail-card">
            <h3>ü™ë ƒê·∫∑t B√†n (<%= reservations.length %>)</h3>
            <table class="admin-table">
                <thead>
                    <tr>
                        <th>M√£ ƒê·∫∑t B√†n</th>
                        <th>Chi Nh√°nh</th>
                        <th>Ng√†y Gi·ªù</th>
                        <th>S·ªë Kh√°ch</th>
                        <th>T·ªïng Ti·ªÅn</th>
                        <th>Tr·∫°ng Th√°i</th>
                    </tr>
                </thead>
                <tbody>
                    <% reservations.forEach(res => { %>
                    <tr>
                        <td><%= res._id.toString().slice(-6) %></td>
                        <td><%= res.branchId?.name || 'N/A' %></td>
                        <td><%= new Date(res.date).toLocaleDateString('vi-VN') %> <%= res.time %></td>
                        <td><%= res.guests %> ng∆∞·ªùi</td>
                        <td><strong><%= res.totalAmount?.toLocaleString('vi-VN') %> ƒë</strong></td>
                        <td><span class="status-badge status-<%= res.status %>"><%= res.status %></span></td>
                    </tr>
                    <% }) %>
                </tbody>
            </table>
        </div>
        <% } %>

        <% if ((!orders || orders.length === 0) && (!reservations || reservations.length === 0) && (!payments || payments.length === 0)) { %>
        <div class="empty-message">
            <p>Ng∆∞·ªùi d√πng n√†y ch∆∞a c√≥ ho·∫°t ƒë·ªông n√†o.</p>
        </div>
        <% } %>
    </div>
</section>

<style>
    .info-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 1rem;
        margin-top: 1rem;
    }
    
    .info-item {
        display: flex;
        flex-direction: column;
        gap: 0.25rem;
    }
    
    .info-item strong {
        color: var(--primary);
        font-size: 0.9rem;
    }
    
    .info-item span {
        color: var(--text);
        font-size: 1rem;
    }
    
    .type-badge {
        display: inline-block;
        padding: 0.25rem 0.75rem;
        border-radius: 15px;
        font-size: 0.8rem;
        font-weight: bold;
    }
    
    .type-badge.order {
        background-color: #e3f2fd;
        color: #1976d2;
    }
    
    .type-badge.reservation {
        background-color: #f3e5f5;
        color: #7b1fa2;
    }
</style>
