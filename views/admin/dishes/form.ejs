<section class="admin-section">
    <div class="container">
        <h1><%= dish ? 'S·ª≠a M√≥n ƒÇn' : 'Th√™m M√≥n ƒÇn M·ªõi' %></h1>
        
        <!-- Added error message display -->
        <% if (typeof error !== 'undefined' && error) { %>
            <div class="alert alert-error"><%= error %></div>
        <% } %>
        
        <!-- Fixed form action URL from /admin/dish to /admin/dishes -->
        <form method="POST" action="<%= dish ? '/admin/dishes/' + dish._id : '/admin/dishes' %>" class="admin-form">
            <div class="form-group">
                <label for="name">T√™n M√≥n ƒÇn *</label>
                <input type="text" id="name" name="name" value="<%= dish?.name || '' %>" placeholder="Nh·∫≠p t√™n m√≥n ƒÉn" required>
            </div>

            <div class="form-group">
                <label for="description">M√¥ T·∫£ *</label>
                <textarea id="description" name="description" rows="4" placeholder="Nh·∫≠p m√¥ t·∫£ chi ti·∫øt" required><%= dish?.description || '' %></textarea>
            </div>

            <div class="form-group">
                <label for="price">Gi√° (VNƒê) *</label>
                <input type="number" id="price" name="price" value="<%= dish?.price || '' %>" placeholder="Nh·∫≠p gi√°" min="0" required>
            </div>

            <!-- Improved image input with preview and better UX -->
            <div class="form-group">
                <label for="image">H√¨nh ·∫¢nh (URL) *</label>
                <input type="url" id="image" name="image" value="<%= dish?.image || '' %>" placeholder="https://example.com/image.jpg" required>
                <small>Nh·∫≠p URL h√¨nh ·∫£nh. H√¨nh s·∫Ω t·ª± ƒë·ªông hi·ªÉn th·ªã v·ªõi k√≠ch th∆∞·ªõc ph√π h·ª£p</small>
                <% if (dish?.image) { %>
                    <div class="image-preview">
                        <img src="<%= dish.image %>" alt="<%= dish.name %>" onerror="this.src='https://images.unsplash.com/photo-1546069901-ba9599a7e63c?w=300&h=200&fit=crop'">
                    </div>
                <% } %>
            </div>

            <div class="form-group">
                <label for="category">Danh M·ª•c *</label>
                <select id="category" name="category" required>
                    <option value="">-- Ch·ªçn Danh M·ª•c --</option>
                    <option value="appetizer" <%= dish?.category === 'appetizer' ? 'selected' : '' %>>Khai V·ªã</option>
                    <option value="main" <%= dish?.category === 'main' ? 'selected' : '' %>>M√≥n Ch√≠nh</option>
                    <option value="dessert" <%= dish?.category === 'dessert' ? 'selected' : '' %>>Tr√°ng Mi·ªáng</option>
                    <option value="beverage" <%= dish?.category === 'beverage' ? 'selected' : '' %>>ƒê·ªì U·ªëng</option>
                </select>
            </div>

            <div class="form-group">
                <label for="discount">Gi·∫£m Gi√° (%)</label>
                <input type="number" id="discount" name="discount" value="<%= dish?.discount || 0 %>" placeholder="0" min="0" max="100">
            </div>

            <!-- Added event selection dropdown -->
            <div class="form-group">
                <label for="event">S·ª± Ki·ªán Gi·∫£m Gi√° (T√πy ch·ªçn)</label>
                <select id="event" name="event">
                    <option value="">-- Kh√¥ng √°p d·ª•ng s·ª± ki·ªán --</option>
                    <% if (events && events.length > 0) { %>
                        <% events.forEach(event => { %>
                            <option value="<%= event._id %>" <%= dish?.event && dish.event._id.toString() === event._id.toString() ? 'selected' : '' %>>
                                <%= event.title %> - <%= event.discountPercent %>% off
                            </option>
                        <% }) %>
                    <% } %>
                </select>
                <small>Ch·ªçn s·ª± ki·ªán ƒë·ªÉ √°p d·ª•ng gi·∫£m gi√°. N·∫øu ch·ªçn, gi√° tr·ªã gi·∫£m gi√° tr√™n s·∫Ω b·ªã ghi ƒë√® b·ªüi gi·∫£m gi√° c·ªßa s·ª± ki·ªán.</small>
            </div>

            <div class="form-actions">
                <button type="submit" class="btn btn-primary">
                    <%= dish ? 'üíæ C·∫≠p Nh·∫≠t' : '‚ûï Th√™m M·ªõi' %>
                </button>
                <a href="/admin/dishes" class="btn btn-secondary">‚ùå H·ªßy</a>
            </div>
        </form>
    </div>
</section>
