<section class="admin-section">
    <div class="container">
        <div class="section-header">
            <h1>üçΩÔ∏è Qu·∫£n L√Ω M√≥n ƒÇn</h1>
            <a href="/admin/dishes/new" class="btn btn-primary">‚ûï Th√™m M√≥n ƒÇn M·ªõi</a>
        </div>

        <% if (typeof success !== 'undefined' && success) { %>
            <div class="alert alert-success"><%= success %></div>
        <% } %>

        <% if (dishes && dishes.length > 0) { %>
            <div class="admin-card">
                <table class="admin-table">
                    <thead>
                        <tr>
                            <th>H√¨nh ·∫¢nh</th>
                            <th>T√™n</th>
                            <th>M√¥ T·∫£</th>
                            <th>Gi√°</th>
                            <th>Danh M·ª•c</th>
                            <th>Gi·∫£m Gi√°</th>
                            <th>H√†nh ƒê·ªông</th>
                        </tr>
                    </thead>
                    <tbody>
                        <% dishes.forEach(dish => { %>
                            <tr>
                                <td>
                                    <img src="<%= dish.image %>" alt="<%= dish.name %>" 
                                         style="width: 60px; height: 60px; object-fit: cover; border-radius: 8px;"
                                         onerror="this.src='https://images.unsplash.com/photo-1546069901-ba9599a7e63c?w=60&h=60&fit=crop'">
                                </td>
                                <td><strong><%= dish.name %></strong></td>
                                <td style="max-width: 200px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
                                    <%= dish.description %>
                                </td>
                                <td>
                                    <% const eventDiscount = dish.event ? dish.event.discount : 0; %>
                                    <% const finalDiscount = eventDiscount || dish.discount; %>
                                    <% if (finalDiscount > 0) { %>
                                        <div>
                                            <span style="text-decoration: line-through; color: #999; font-size: 0.85rem;">
                                                <%= dish.price.toLocaleString('vi-VN') %>ƒë
                                            </span>
                                            <br>
                                            <strong style="color: var(--accent);">
                                                <%= (dish.price * (1 - finalDiscount / 100)).toLocaleString('vi-VN') %>ƒë
                                            </strong>
                                        </div>
                                    <% } else { %>
                                        <strong><%= dish.price.toLocaleString('vi-VN') %>ƒë</strong>
                                    <% } %>
                                </td>
                                <td>
                                    <% const categoryMap = {
                                        'appetizer': { icon: 'ü•ó', label: 'Khai V·ªã', color: '#d1ecf1' },
                                        'main': { icon: 'üçñ', label: 'M√≥n Ch√≠nh', color: '#fff3cd' },
                                        'dessert': { icon: 'üç∞', label: 'Tr√°ng Mi·ªáng', color: '#f8d7da' },
                                        'beverage': { icon: 'üçπ', label: 'ƒê·ªì U·ªëng', color: '#d4edda' }
                                    }; %>
                                    <% const cat = categoryMap[dish.category] || { icon: 'üçΩÔ∏è', label: dish.category, color: '#e2e3e5' }; %>
                                    <span class="category-badge" style="background: <%= cat.color %>;">
                                        <%= cat.icon %> <%= cat.label %>
                                    </span>
                                </td>
                                <td>
                                    <% if (dish.event) { %>
                                        <span class="discount-badge" style="background: linear-gradient(135deg, #FF6B6B 0%, #FF8E53 100%);">
                                            <%= dish.event.discount %>% (<%= dish.event.title %>)
                                        </span>
                                    <% } else if (dish.discount > 0) { %>
                                        <span class="discount-badge"><%= dish.discount %>%</span>
                                    <% } else { %>
                                        <span style="color: #999;">-</span>
                                    <% } %>
                                </td>
                                <td class="action-buttons">
                                    <a href="/admin/dishes/<%= dish._id %>/edit" class="btn btn-small btn-primary">‚úèÔ∏è S·ª≠a</a>
                                    <a href="/admin/dishes/<%= dish._id %>/delete" class="btn btn-small btn-danger" onclick="return confirm('B·∫°n ch·∫Øc ch·∫Øn mu·ªën x√≥a?')">üóëÔ∏è X√≥a</a>
                                </td>
                            </tr>
                        <% }); %>
                    </tbody>
                </table>
            </div>
        <% } else { %>
            <div class="empty-message">
                <p>Ch∆∞a c√≥ m√≥n ƒÉn n√†o. <a href="/admin/dishes/new" class="btn btn-primary">Th√™m ngay</a></p>
            </div>
        <% } %>
    </div>
</section>

<style>
    
    .category-badge {
        padding: 0.25rem 0.75rem;
        border-radius: 15px;
        font-size: 0.85rem;
        font-weight: 600;
        white-space: nowrap;
    }
    
    .discount-badge {
        background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
        color: white;
        padding: 0.25rem 0.75rem;
        border-radius: 15px;
        font-weight: bold;
        font-size: 0.9rem;
    }
</style>
